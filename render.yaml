services:
  # Main API service
  - type: web
    name: paper-helper-backend
    runtime: docker
    dockerfilePath: ./Dockerfile
    repo: https://github.com/yuw136/paper-helper  # Update this!
    branch: main
    region: oregon  # Change if needed: oregon, frankfurt, singapore
    plan: free  # Change to 'starter' or higher for production
    
    # Environment variables (set these in Render Dashboard)
    envVars:
      # Database
      - key: SUPABASE_DATABASE_URL
        sync: false
      
      # API Keys
      - key: LLAMA_CLOUD_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: DEEPSEEK_API_KEY
        sync: false
      
      # Supabase Storage
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: SUPABASE_PAPERS_BUCKET
        value: papers
      - key: SUPABASE_REPORTS_BUCKET
        value: reports
      
      # LangChain
      - key: LANGCHAIN_TRACING_V2
        value: true
      - key: LANGCHAIN_API_KEY
        sync: false
      - key: LANGCHAIN_PROJECT
        value: paper_helper
      
      # CORS (add your frontend URL)
      - key: BACKEND_CORS_ORIGINS
        value: https://paper-helper.onrender.com,http://localhost:5173
      
      # Email Configuration
      - key: EMAIL_SENDER
        sync: false
      - key: EMAIL_PASSWORD
        sync: false
      - key: EMAIL_RECEIVER
        sync: false
      - key: SMTP_SERVER
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: 587
      
      # Model Configuration (optional)
      - key: WRITING_MODEL_NAME
        value: gpt-4o
      - key: WRITING_MODEL_TEMPERATURE
        value: 0.2
      - key: DEDUCE_MODEL_NAME
        value: o3-mini
      - key: EMBEDDING_MODEL_NAME
        value: text-embedding-3-small
      
      # Document Processing
      - key: CHUNK_SIZE
        value: 1024
      - key: CHUNK_OVERLAP
        value: 200
    
    # Health check
    healthCheckPath: /

  # Frontend static site
  - type: static
    name: paper-helper-frontend
    runtime: static
    repo: https://github.com/yuw136/paper-helper 
    branch: main
    
    buildCommand: cd frontend && npm install && npm run build
    publishDir: frontend/build
    
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

    envVars:
      - key: VITE_API_BASE_URL
        fromService:
          type: web
          name: paper-helper-backend  
          property: url


